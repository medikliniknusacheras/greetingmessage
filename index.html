<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Careclinic Visit Recorder</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 2rem auto; padding: 1rem; border: 1px solid #ccc; border-radius: 8px; }
    input, button { width: 100%; margin-top: 10px; padding: 8px; font-size: 1rem; }
    button { cursor: pointer; background-color: #4CAF50; color: white; border: none; border-radius: 4px; }
    h2 { text-align: center; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .btn-small { padding: 4px 8px; font-size: 0.9rem; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 4px; display: inline-block; }
    .note { font-size: 0.9rem; color: #666; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Careclinic Visit Form</h2>
<form id="visit-form">
  <input type="text" id="name" placeholder="Patient Name" required />
  <input type="tel" id="phone" placeholder="WhatsApp Number (e.g. 60123456789)" required />
  <input type="date" id="visit-date" required />
  <button type="submit">Save Visit</button>
</form>

<button onclick="sendGreeting()">Send Follow-up Message</button>
<p class="note">Note: If WhatsApp doesn't open, please allow pop-ups for this site.</p>

<h3>Patient Visit Records</h3>
<table id="visit-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Date of Visit</th>
      <th>Phone Number</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const clinic = {
    name: "Careclinic Mediklinik Nusa",
    address: "No 42A, 00, Jln Damai Perdana 6/1A, Bandar Damai Perdana, 56000 Cheras, Wilayah Persekutuan Kuala Lumpur",
    hours: "Everyday: 8:00am - 11:00pm",
    reviewLink: "https://g.page/r/CStVx8R9JveLEAE/review"
  };

  const form = document.getElementById('visit-form');
  const tableBody = document.querySelector('#visit-table tbody');

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    const visit = {
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      date: document.getElementById('visit-date').value,
      timestamp: new Date().getTime()
    };

    let visits = JSON.parse(localStorage.getItem('visits') || '[]');
    visits.push(visit);
    localStorage.setItem('visits', JSON.stringify(visits));
    form.reset();
    loadVisits();
  });

  function sendGreeting() {
    try {
      const visits = JSON.parse(localStorage.getItem('visits') || '[]');
      if (visits.length === 0) return alert('No patient visits saved.');

      const latest = visits[visits.length - 1];
      const msg = `
Hello ${latest.name},

We hope you're feeling better after your visit on ${latest.date}. How is your condition now?

If you need any further assistance or have questions about your treatment, please don't hesitate to reach out to us.

📍 ${clinic.address}
🕒 ${clinic.hours}
📞 Clinic Phone: [YOUR_CLINIC_PHONE]

Wishing you good health,
${clinic.name} Team

---

Hai ${latest.name},

Kami harap anda berasa lebih baik selepas lawatan pada ${latest.date}. Bagaimana keadaan anda sekarang?

Jika anda memerlukan bantuan lanjut atau mempunyai soalan tentang rawatan, sila hubungi kami.

📍 ${clinic.address}
🕒 ${clinic.hours}
📞 Telefon Klinik: [YOUR_CLINIC_PHONE]

Semoga sihat sentiasa,
Pasukan ${clinic.name}

---

${latest.name} 您好，

我们希望您在 ${latest.date} 就诊后感觉好些了。您现在的情况如何？

如果您需要进一步的帮助或对治疗有任何疑问，请随时联系我们。

📍 ${clinic.address}
🕒 ${clinic.hours}
📞 诊所电话: [YOUR_CLINIC_PHONE]

祝您健康，
${clinic.name} 团队
`.trim();

      // Create temporary link element
      const link = document.createElement('a');
      link.href = `https://wa.me/${latest.phone}?text=${encodeURIComponent(msg)}`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    } catch (error) {
      console.error('Error sending greeting:', error);
      alert('Failed to open WhatsApp. Please try again or check your pop-up settings.');
    }
  }

  function sendReviewTo(patient) {
    try {
      const msg = `
Hello ${patient.name},

We wanted to check how you're doing since your visit on ${patient.date}. 

If you'd like to share your experience with others, you can do so here:
${clinic.reviewLink}

We're always here if you need any medical assistance.

Warm regards,
${clinic.name} Team

---

Hai ${patient.name},

Kami ingin tahu perkembangan anda selepas lawatan pada ${patient.date}.

Jika anda ingin berkongsi pengalaman, anda boleh melakukannya di sini:
${clinic.reviewLink}

Kami sentiasa sedia jika anda memerlukan bantuan perubatan.

Salam mesra,
Pasukan ${clinic.name}

---

${patient.name} 您好，

我们想了解您在 ${patient.date} 就诊后的情况。

如果您愿意分享您的体验，可以在这里进行：
${clinic.reviewLink}

如需任何医疗帮助，我们随时为您服务。

此致，
${clinic.name} 团队
`.trim();

      // Create temporary link element
      const link = document.createElement('a');
      link.href = `https://wa.me/${patient.phone}?text=${encodeURIComponent(msg)}`;
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    } catch (error) {
      console.error('Error sending follow-up:', error);
      alert('Failed to open WhatsApp. Please try again or check your pop-up settings.');
    }
  }

  function loadVisits() {
    const visits = JSON.parse(localStorage.getItem('visits') || '[]');
    tableBody.innerHTML = "";

    visits.forEach((visit, index) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${visit.name}</td>
        <td>${visit.date}</td>
        <td>${visit.phone}</td>
        <td><a href="#" class="btn-small" onclick='sendReviewTo(${JSON.stringify(visit)}); return false;'>Follow-up</a></td>
      `;
      tableBody.appendChild(row);
    });
  }

  // Load on page load
  loadVisits();
</script>

</body>
</html>